<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AI ç»“æœæ˜¾ç¤ºæµ‹è¯•</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div id="test-container" style="padding: 20px;">
        <h1>AI ç»“æœæ˜¾ç¤ºæµ‹è¯•</h1>
        <p>æµ‹è¯•é¡¹ï¼š</p>
        <ul>
            <li>âœ… X å…³é—­æŒ‰é’®å¯è§æ€§ï¼ˆå³ä¸Šè§’åŠé€æ˜åœ†å½¢æŒ‰é’®ï¼‰</li>
            <li>âœ… ç‚¹å‡»å¼•ç”¨ä¸Šæ ‡è·³è½¬åˆ°å¼•ç”¨åˆ—è¡¨</li>
            <li>âœ… ç‚¹å‡» â†© è¿”å›æ­£æ–‡</li>
            <li>âœ… å…³é—­åé‡æ–°æ‰“å¼€ç§’åŠ è½½ï¼ˆç¼“å­˜ï¼‰</li>
            <li>âœ… è¿”å›é¡¶éƒ¨æŒ‰é’®åœ¨ AI åŒºæ‰“å¼€æ—¶æ§åˆ¶ AI åŒºæ»šåŠ¨</li>
        </ul>
        <button id="test-btn" style="padding: 10px 20px; font-size: 16px;">æµ‹è¯• AI ç»“æœæ˜¾ç¤º</button>
        <button id="toggle-dark" style="padding: 10px 20px; font-size: 16px; margin-left: 10px;">åˆ‡æ¢å¤œé—´æ¨¡å¼</button>
    </div>

    <!-- AI ç»“æœåŒº -->
    <div id="ai-result" class="ai-result" style="display: none;">
        <button id="ai-result-close" class="ai-close-btn">âœ•</button>
        <div class="ai-result-header">
            <h3 id="ai-result-title"></h3>
        </div>
        <div id="ai-result-content" class="ai-result-content"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿ AI è¿”å›æ•°æ®
        var mockData = {
            content: "å¥½çš„ï¼Œä»¥ä¸‹æ˜¯æ ¹æ®æ‚¨æä¾›çš„ã€Šç›çª¦ç¦éŸ³ã€‹ç¬¬ä¸€ç« ç»æ–‡ï¼ˆ1:1-25ï¼‰æ‰€ä½œçš„æ€»ç»“[^1] [^6]ã€‚\n\n## è€¶ç¨£åŸºç£çš„æ—è°±ä¸è¯ç”Ÿå™äº‹æ€»ç»“\n\nè¿™æ®µç»æ–‡ä¸»è¦åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼šè€¶ç¨£åŸºç£çš„æ—è°±ï¼ˆ1:1-17ï¼‰å’Œç¥‚çš„å¥‡å¦™è¯ç”Ÿï¼ˆ1:18-25ï¼‰[^1]ã€‚\n\n### ä¸€ã€ è€¶ç¨£åŸºç£çš„æ—è°± (1:1-17)\n\nã€Šç›çª¦ç¦éŸ³ã€‹ä»¥è€¶ç¨£åŸºç£çš„æ—è°±å¼€ç¯‡ï¼Œå¼ºè°ƒç¥‚æ˜¯"äºšå·´éƒä¹‹å­ï¼Œè¾¾å‘³ä¹‹å­"[^1]ã€‚æ—è°±çš„ç›®çš„æ˜¯é€šè¿‡è‹¥ç‘Ÿçš„åˆæ³•çˆ¶äº²èº«ä»½ï¼Œç¡®ç«‹è€¶ç¨£æ˜¯äºšå·´éƒå’Œè¾¾å‘³çš„åè£”[^4] [^5]ã€‚\n\n### äºŒã€ è€¶ç¨£åŸºç£çš„è¯ç”Ÿå™äº‹ (1:18-25)\n\nè¿™æ®µç»æ–‡è¯¦ç»†æè¿°äº†è€¶ç¨£è¯ç”Ÿçš„ç‰¹æ®Šæƒ…å†µï¼Œé‡ç‚¹åœ¨äºè‹¥ç‘Ÿå¦‚ä½•é¢å¯¹ç›åˆ©äºšå› åœ£ç¥è€Œæ€€å­•çš„äº‹å®[^1] [^2]ã€‚",
            citations: [
                {
                    document_title: "The Holy Bible",
                    document_author: "The New Revised Standard Version, Catholic Edition (NRSV-CE)",
                    document_reference: "Matthew 1:1-25",
                    document_year: "1993",
                    source_url: "https://www.magisterium.com/docs/7ab6e175-afab-4262-915a-0e98ce0d133d/ref/Matthew%201:1-25"
                },
                {
                    document_title: "General Audience of 28 January 1987",
                    document_author: "Pope John Paul II",
                    document_reference: "",
                    document_year: "1987",
                    source_url: "https://www.magisterium.com/docs/d0765823-d0a0-4e52-b9b0-baa26fbba0b9/ref/"
                }
            ]
        };

        function formatAIResponse(data) {
            var html = '';
            var content = typeof data === 'string' ? data : data.content;
            var citations = (typeof data === 'object' && data.citations) ? data.citations : [];
            
            if (typeof marked !== 'undefined') {
                try {
                    marked.setOptions({
                        breaks: true,
                        gfm: true,
                        headerIds: false,
                        mangle: false
                    });
                    
                    html = marked.parse(content);
                    
                    html = html.replace(/\[\^(\d+)\]/g, function(match, num) {
                        return '<sup class="ref-link"><a href="#ref-' + num + '" id="refback-' + num + '">[' + num + ']</a></sup>';
                    });
                    
                    if (citations && citations.length > 0) {
                        html += '<div class="references"><h4>ğŸ“š å¼•ç”¨èµ„æ–™</h4><ol>';
                        for (var i = 0; i < citations.length; i++) {
                            var citation = citations[i];
                            var refNum = i + 1;
                            var refText = '';
                            
                            if (citation.document_title) {
                                refText += '<strong>' + citation.document_title + '</strong>';
                            }
                            if (citation.document_reference) {
                                refText += ' ' + citation.document_reference;
                            }
                            if (citation.document_author) {
                                refText += ' - ' + citation.document_author;
                            }
                            if (citation.document_year && citation.document_year !== '0') {
                                refText += ' (' + citation.document_year + ')';
                            }
                            if (citation.source_url) {
                                refText += ' <a href="' + citation.source_url + '" target="_blank" rel="noopener" class="source-link">ğŸ”— æŸ¥çœ‹åŸæ–‡</a>';
                            }
                            
                            html += '<li id="ref-' + refNum + '">' + refText + ' <a href="#refback-' + refNum + '" class="back-ref">â†©</a></li>';
                        }
                        html += '</ol></div>';
                    }
                    
                    return html;
                } catch (e) {
                    console.error('Markdown è§£æå¤±è´¥:', e);
                    return '<p>' + content + '</p>';
                }
            }
            return '<p>' + content + '</p>';
        }

        document.getElementById('test-btn').addEventListener('click', function() {
            var resultBox = document.getElementById('ai-result');
            var resultContent = document.getElementById('ai-result-content');
            
            resultContent.innerHTML = formatAIResponse(mockData);
            resultBox.style.display = 'block';
        });

        document.getElementById('ai-result-close').addEventListener('click', function() {
            document.getElementById('ai-result').style.display = 'none';
        });

        document.getElementById('toggle-dark').addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
        });
    </script>
</body>
</html>
